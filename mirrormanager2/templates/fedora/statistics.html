{% extends "master_noauth.html" %}

{% block title %}Statistics{% endblock %}

{%block tag %}statistics{% endblock %}

{% block content %}
<h1>Statistics</h1>
<p class="centered">
  Mirrorlist access breakdown by
  <a href="{{url_for('base.statistics')}}/{{ today }}/countries">country</a>
  |
  <a href="{{url_for('base.statistics')}}/{{ today }}/archs">architecture</a> |
  <a href="{{url_for('base.statistics')}}/{{ today }}/repositories">repository</a>
  on {{today}}
</p>
<p class="centered">
  {% if yesterday %}
  <a href="{{url_for('base.statistics', date=yesterday, cat=cat) }}">&lt;{{ yesterday }}</a>
  {%- endif -%}
  |
  {% if tomorrow %}
  <a href="{{url_for('base.statistics', date=tomorrow, cat=cat)}}">{{ tomorrow }}&gt;</a>
  {%- endif -%}
</p>

<div class="chart-container" style="position: relative; height:40vh; width:100%">
    <canvas id="chart" style="margin: auto"></canvas>
</div>

<h2>Details</h2>
<table class="mx-auto">
  <tr id="matrixtitle">
    <th>{{ cat|title }}</th>
    <th class="text-xs-center">%</th>
    <th>#Requests</th>
  </tr>
  {% for stat in stats %}
  <tr class="{{ loop.cycle('', 'matrix_even') }}">
    <td>{{ stat.name }}</td>
    <td class="text-xs-right">{{ "{:03.4f}".format(stat.percent) }} %</td>
    <td class="text-xs-right">{{ stat.requests }}</td>
  </tr>
  {% endfor %}
  <tr>
    <td><strong>Total</strong></td>
    <td class="text-xs-right" colspan="2"><strong>{{ total }}</strong></td>
  </tr>
</table>

{% endblock %}


{% block jscripts %}
{{ super() }}
<script src="{{ url_for('static', filename='chart.js') }}"></script>
<script>
    const canvas = document.getElementById('chart');
    new Chart(canvas, {
        type: 'doughnut',
        data: {
            labels: {{ graph_labels | tojson }},
            datasets: [{{ graph_dataset | tojson }}],
        },
        options: {
            plugins: {
                legend: {
                    display: false,
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return " " + context.formattedValue + " %";
                        }
                    }
                }
            },
        }
    });
</script>
{% endblock %}
